{% extends "base.html" %}

{% block content %}
<h2>Available Doctors</h2>

{% if doctors %}
<table class="table table-hover">
    <thead>
        <tr>
            <th>S.N</th>
            <th>Name</th>
            <th>Specialization</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Slots</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for doctor in doctors %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ doctor.name }}</td>
            <td>{{ doctor.specialization }}</td>
            <td>{{ doctor.email }}</td>
            <td>{{ doctor.phone }}</td>
            <td>
                {% if doctor.slots %}
                    <ul class="list-unstyled mb-0">
                        {% for slot in doctor.slots %}
                            {% set active_appts = slot.appointments
                                | selectattr('status', 'ne', 'Canceled')
                                | selectattr('status', 'ne', 'Rescheduled (by Admin)')
                                | list %}
                            <li>
                                {{ slot.start_time.strftime('%I:%M %p') if slot.start_time else 'N/A' }}
                                -
                                {{ slot.end_time.strftime('%I:%M %p') if slot.end_time else 'N/A' }}
                                {% if active_appts|length > 0 %}
                                    <span class="badge bg-danger">Booked</span>
                                {% else %}
                                    <span class="badge bg-success">Available</span>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <span class="text-muted">No slots added</span>
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('book', doctor_id=doctor.id) }}" class="btn btn-sm btn-primary">
                    Book
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No doctors available at the moment.</p>
{% endif %}
{% endblock %}
